make_sax_driver="make sax_driver"
link_xml_libs="-lexpat"
cxx_xml_defs="-DUSE_EXPAT"


AC_ARG_WITH(xml-home,
            [  --with-xml-home=HOME		Compile with HOME],
            ok=${withval},
            ok="no")
if test "${ok}" != "no" && test "${ok}" != "yes" && test -n "${ok}"
then
    AC_MSG_RESULT(setting xml home... ${ok})
    link_xml_libpath="-L${ok}/lib"
    cxx_xml_includes="-I${ok}/include"
    xml_home_defined="yes"
    make_sax_driver="echo 'skipping sax driver installation'"
fi



AC_ARG_ENABLE(xml-layer,
                [  --enable-xml-layer[=LAYER]  	Specify the xml layer:
            				expat: Non-validating, ultra-fast cross-platform parser
            				xerces: Apache Project cross-platform validating parser ],
            ok=${enableval},
            ok="no")

if test "${ok}" != "no"
then
   case "${ok}" in 
        expat)
            AC_MSG_RESULT(enabling expat...)
            link_xml_libs="-lexpat"
            cxx_xml_defs="-DUSE_EXPAT"
         
            # If home was not defined then check
            # if expat is installed
            if test "${xml_home_defined}" != "yes"
            then
                # Try this, if its there, use it, else use the driver
                AC_CHECK_LIB(expat, XML_ParserCreate, 
                [ echo "detected local copy of expat..."],
                [
                    link_xml_libpath="-L$PWD/xml.lite/lib/${target}/${lib_dir}"
                    cxx_xml_includes="-I$PWD/xml.lite/include"
                    make_sax_driver="make sax_driver"
		    AC_MSG_RESULT(using bundled sax driver...)
                ]
                )
                AC_CHECK_HEADER(expat.h,
                [ echo "detected local header for expat.h..."],
                [
                    link_xml_libpath="-L$PWD/xml.lite/lib/${target}/${lib_dir}"
                    cxx_xml_includes="-I$PWD/xml.lite/include"
                    make_sax_driver="make sax_driver"
		    AC_MSG_RESULT(using bundled sax driver...)
                ]
                )
            fi
        ;;
        xerces)
            AC_MSG_RESULT(enabling xerces...)
            link_xml_libs="-lxerces-c"
            cxx_xml_defs="-DUSE_XERCES"
        ;;
    esac
    if test "${xml_home_defined}" = "yes"
    then
        AC_MSG_RESULT(${ok} includes directory... ${cxx_xml_includes})
        AC_MSG_RESULT(${ok} library directory... ${link_xml_libpath})
    fi
fi

AC_SUBST(cxx_xml_includes)
AC_SUBST(cxx_xml_defs)
AC_SUBST(link_xml_libs)
AC_SUBST(link_xml_libpath)
AC_SUBST(make_sax_driver)
